@{
    ViewData["Title"] = "Register";
}

<h2>Create Account</h2>

<form id="registerForm">
    <div class="form-group mb-2">
        <label>Email</label>
        <input type="email" id="regEmail" class="form-control" required />
    </div>
    <div class="form-group mb-2">
        <label>Password</label>
        <input type="password" id="regPassword" class="form-control" required />
    </div>
    <button type="submit" class="btn btn-success">Register</button>
    <p class="mt-2"><a asp-action="Login">Back to Login</a></p>
</form>

@section Scripts {
    <script>
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;

            try {
                // Create user in Firebase
                const userCredential = await firebase.auth().createUserWithEmailAndPassword(email, password);
                const idToken = await userCredential.user.getIdToken();

                // Send to backend to create ASP.NET Identity user
                const response = await fetch('/Account/FirebaseRegister', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ idToken })
                });

                const data = await response.json();
                if (data.success) {
                    alert('Account created! Please log in.');
                    window.location.href = '/Account/Login';
                }
            } catch (error) {
                alert('Registration failed: ' + error.message);
            }
        });
    </script>
}