@{
    Layout = null;
    var currentController = ViewContext.RouteData.Values["controller"]?.ToString();
    var currentAction = ViewContext.RouteData.Values["action"]?.ToString();
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Streamline Admin</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/auth.styles.css" asp-append-version="true" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <a href="@Url.Action("Dashboard", "Admin")" class="brand">
            <img src="~/images/Logo_Only_Light.jpg" style="width:40px;height:40px;border-radius:50%;" alt="Logo" />
            <span>Streamline</span>
        </a>
        <nav class="mt-3">
            <a class="nav-link @(currentController == "Admin" && currentAction == "Dashboard" ? "active" : "")"
               asp-controller="Admin" asp-action="Dashboard">
                <i class="bi bi-speedometer2"></i>
                <span>Dashboard</span>
            </a>
            <a class="nav-link @(currentController == "Admin" && currentAction == "Audits" ? "active" : "")"
               asp-controller="Admin" asp-action="Audits">
                <i class="bi bi-list-check"></i>
                <span>Audits</span>
            </a>
            <a class="nav-link @(currentController == "Admin" && currentAction == "Users" ? "active" : "")"
               asp-controller="Admin" asp-action="Users">
                <i class="bi bi-people"></i>
                <span>Users</span>
            </a>
            <a class="nav-link @(currentController == "Admin" && currentAction == "Accounts" ? "active" : "")"
               asp-controller="Admin" asp-action="Accounts">
                <i class="bi bi-wallet2"></i>
                <span>Accounts</span>
            </a>
            <a class="nav-link @(currentController == "Admin" && currentAction == "Notifications" ? "active" : "")"
               asp-controller="Admin" asp-action="Notifications">
                <i class="bi bi-bell"></i>
                <span>Notifications</span>
            </a>

            <!-- Theme Toggle -->
            <button id="themeToggle" class="btn btn-sm btn-icon" title="Toggle Theme"
                    style="width: 40px; height: 40px; border-radius: 50%; background: #f0f0f0; color: #6B46C1; border: none; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <i class="bi bi-moon-stars-fill" id="themeIcon"></i>
            </button>
        </nav>

        <div class="mt-auto p-3">
            @if (User.Identity?.IsAuthenticated ?? false)
            {
                <form asp-controller="Account" asp-action="Logout" method="post" class="d-block">
                    <button type="submit" class="btn btn-outline-light w-100 d-flex align-items-center justify-content-center gap-2">
                        <i class="bi bi-box-arrow-right"></i>
                        <span>Logout</span>
                    </button>
                </form>
            }
            else
            {
                <div class="d-flex gap-2">
                    <a asp-controller="Account" asp-action="Login" class="btn btn-outline-light flex-fill">Login</a>
                    <a asp-controller="Account" asp-action="Register" class="btn btn-light flex-fill">Register</a>
                </div>
            }
        </div>
    </div>

    <!-- Toggle Button -->
    <div class="sidebar-toggle" id="sidebarToggle">
        <i class="bi bi-list togglecolor"></i>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <div class="topbar d-flex justify-content-end mb-3">
            <a asp-controller="Admin" asp-action="Profile" class="profile-section text-white text-decoration-none d-flex align-items-center gap-2">
                <img src="~/images/default-profile.png" alt="Profile" style="width:40px;height:40px;border-radius:50%;object-fit:cover;" />
                <span>@(User.Identity?.IsAuthenticated == true ? User.Identity.Name : "Admin")</span>
            </a>
        </div>
        <main role="main">
            @RenderBody()
        </main>
    </div>

    @* <!-- Footer -->
    <footer id="footer">
        <div class="container text-center">
            &copy; 2025 - Streamline Admin - <a asp-controller="Account" asp-action="Privacy">Privacy</a>
        </div>
    </footer> *@

    <!-- Scripts -->
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyD2-E9jW53iRWevFV2YqDPAtGsjzHUqfk4",
            authDomain: "streamline-4994a.firebaseapp.com",
            projectId: "streamline-4994a",
            storageBucket: "streamline-4994a.firebasestorage.app",
            messagingSenderId: "719692478764",
            appId: "1:719692478764:web:057ac09645b98bc3a39489",
            measurementId: "G-FMNT0PLDDF"
        };
        firebase.initializeApp(firebaseConfig);
    </script>

    <!-- Sidebar Toggle Script -->
    <script>
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('mainContent');
        const footer = document.getElementById('footer');
        const toggleBtn = document.getElementById('sidebarToggle');
        const toggleIcon = toggleBtn.querySelector('i');

        toggleBtn.addEventListener('click', () => {
            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('collapsed');
            footer.classList.toggle('collapsed');
            toggleBtn.classList.toggle('collapsed');
            if (sidebar.classList.contains('collapsed')) {
                toggleIcon.classList.replace('bi-list', 'bi-arrow-right');
            } else {
                toggleIcon.classList.replace('bi-arrow-right', 'bi-list');
            }
        });

        // Auto-collapse on mobile
        if (window.innerWidth <= 768) {
            sidebar.classList.add('collapsed');
            mainContent.classList.add('collapsed');
            footer.classList.add('collapsed');
            toggleBtn.classList.add('collapsed');
            toggleIcon.classList.replace('bi-list', 'bi-arrow-right');
        }
    </script>

    <!-- Theme Toggle Script -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const toggle = document.getElementById("themeToggle");
            const icon = document.getElementById("themeIcon");
            const html = document.documentElement;

            const savedTheme = localStorage.getItem("theme") || "light";
            html.setAttribute("data-theme", savedTheme);
            updateIcon(savedTheme);

            toggle.addEventListener("click", () => {
                const current = html.getAttribute("data-theme");
                const newTheme = current === "dark" ? "light" : "dark";
                html.setAttribute("data-theme", newTheme);
                localStorage.setItem("theme", newTheme);
                updateIcon(newTheme);
            });

            function updateIcon(theme) {
                icon.className = theme === "dark" ? "bi bi-sun-fill" : "bi bi-moon-stars-fill";
            }
        });
    </script>

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>