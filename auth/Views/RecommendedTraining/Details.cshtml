@model Auth.Models.Models.RecommendedTrainingModel

@{
    ViewData["Title"] = "Training Details";
    // Layout = "~/Views/Shared/_EmployeeLayout.cshtml";
}

<div class="container mt-4">
    <div class="card shadow-sm" style="border-color: #4A4A4A;">
        <div class="card-header" style="background-color: #6B46C1; color: #FFFFFF;">
            <h3 class="mb-0">@Model.TrainingName</h3>
        </div>
        <div class="card-body" style="background-color: #F9F9F9;">
            <div class="alert alert-info">
                <strong>Recommended Training</strong> is assigned by HR to help you close skill gaps and grow professionally.
                Once you <strong>Start</strong> the training, your progress will be tracked.
            </div>

            <dl class="row">
                <dt class="col-sm-3 fw-bold" style="color: #4A4A4A;">Reason</dt>
                <dd class="col-sm-9">@Model.Reason</dd>

                <dt class="col-sm-3 fw-bold" style="color: #4A4A4A;">Priority</dt>
                <dd class="col-sm-9">
                    <span class="badge @GetPriorityBadge(Model.Priority)">@Model.Priority</span>
                </dd>

                <dt class="col-sm-3 fw-bold" style="color: #4A4A4A;">Status</dt>
                <dd class="col-sm-9">
                    <span class="badge @GetStatusBadge(Model.Status)">@Model.Status</span>
                </dd>

                <dt class="col-sm-3 fw-bold" style="color: #4A4A4A;">Sent</dt>
                <dd class="col-sm-9">@Model.DateSent:dd MMM yyyy HH:mm</dd>

                @if (Model.DateApproved.HasValue)
                {
                    <dt class="col-sm-3 fw-bold" style="color: #4A4A4A;">Started</dt>
                    <dd class="col-sm-9">@Model.DateApproved.Value:dd MMM yyyy HH:mm</dd>
                }
            </dl>
             @* @if(Model.Status == "awaiting approval"){
                {
                    <div class="alert alert-success">
                        Awaiting approval... this may take up to 5 business days for the document uploaded to be approved. as soon as the training has been approved a notification will be sent, so keep an eye out for that.
                </div>
                } *@

            @if (Model.Status == "rejected")
            {
                <hr class="my-4" />
                <div class="alert alert-error">
                    @Model.Reason
                </div>
            }



            @if (Model.Status == "rejected")
            {
                <hr class="my-4" />
                <form asp-action="ToggleComplete" method="post" class="d-inline">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="id" value="@Model.TrainingId" />

                    <button type="submit" class="btn btn-success" style="background-color: #6B46C1; border: none;">
                        Toggle Complete
                    </button>
                </form>
            
            }
            @if (Model.Status == "awaiting approval")
            {
                <hr class="my-4" />
                <div class="alert alert-success">
                    Awaiting approval... this may take up to 5 business days for the document uploaded to be approved. as soon as the training has been approved a notification will be sent, so keep an eye out for that.
                </div>
            }

            
            @if (Model.Status?.ToLower() == "started")
            {
                <div class="alert alert-success">
                    <strong>Upload Certificate:</strong> Please upload your certificate of completion below, then click <strong>"Mark as Complete"</strong>.
                </div>

                <form asp-action="ToggleComplete" method="post" enctype="multipart/form-data" class="mt-3">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="id" value="@Model.TrainingId" />

                    <div class="mb-3">
                        <label for="certificateFile" class="form-label fw-bold" style="color:#4A4A4A;">Certificate File</label>
                        <input type="file" name="certificateFile" id="certificateFile" class="form-control" accept=".pdf,.jpg,.jpeg,.png" required />
                        <small class="text-muted">Accepted formats: PDF, JPG, PNG (Max 10MB).</small>
                    </div>

                    <button type="submit" class="btn btn-success" style="background-color:#6B46C1; border:none;">
                        Mark as Complete
                    </button>
                </form>
            }
            else if (Model.Status?.ToLower() == "awaiting approval")
            {
                <div class="alert alert-warning">
                    <strong>Awaiting HR Approval:</strong> Your certificate has been submitted for verification.
                </div>

                @if (!string.IsNullOrEmpty(Model.Document))
                {
                    <a class="btn btn-outline-primary" href="/certificates/@Model.Document" download>
                        Download Submitted Certificate
                    </a>
                }
            }



            @* @if (Model.Status != "awaiting approval")
            { 
            <form asp-action="StartTraining" method="post" class="d-inline">
                @Html.AntiForgeryToken()
                <input type="hidden" name="id" value="@Model.TrainingId" />
                <hr class="my-4" />
                @if (Model.Status == "Pending")
                {
                    <button type="submit" class="btn btn-success" style="background-color: #6B46C1; border: none;">
                        Start Training
                    </button>
                }
                else if (Model.Status == "Started")
                {
                    <div class="alert alert-success">
                        You have started this training.
                    </div>
                }
            </form> 
            }*@
            <a asp-action="List" class="btn btn-secondary ms-2">
                Back to List
            </a>
        </div>
    </div>
</div>

@functions {
    string GetStatusBadge(string status) => status?.ToLower() switch
    {
        "pending" => "bg-warning text-dark",
        "started" => "bg-info text-white",
        _ => "bg-light text-dark"
    };

    string GetPriorityBadge(string priority) => priority?.ToLower() switch
    {
        "high" => "bg-danger text-white",
        "medium" => "bg-warning text-dark",
        "low" => "bg-primary text-white",
        _ => "bg-light text-dark"
    };
}